<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Construction Analytics Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { margin:0; font-family:Segoe UI; background:#f4f6f9; }
.hidden { display:none; }

.header {
  background:#1e293b;
  color:white;
  padding:15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.container { padding:20px; }

.card {
  background:white;
  padding:20px;
  border-radius:8px;
  margin-bottom:20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

.kpi-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
}

.kpi {
  padding:20px;
  border-radius:8px;
  color:white;
}

.kpi.primary { background:#3b82f6; }
.kpi.success { background:#10b981; }
.kpi.warning { background:#f59e0b; }
.kpi.danger { background:#ef4444; }

button {
  padding:8px 14px;
  border:none;
  background:#3b82f6;
  color:white;
  border-radius:4px;
  cursor:pointer;
}

button.danger { background:#ef4444; }

input {
  width:100%;
  padding:8px;
  margin-bottom:10px;
}

table {
  width:100%;
  border-collapse:collapse;
}

th,td {
  border:1px solid #ddd;
  padding:8px;
  text-align:left;
}

.tabs {
  display:flex;
  gap:10px;
  margin-bottom:20px;
}

.tab-btn {
  padding:8px 12px;
  background:#e2e8f0;
  cursor:pointer;
}

.tab-btn.active {
  background:#3b82f6;
  color:white;
}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="container">
  <div class="card" style="max-width:400px;margin:auto;margin-top:100px;">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red;"></p>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="header">
    <div>
      Welcome <b id="loggedUser"></b> (<span id="userRole"></span>)
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="container">

    <!-- TABS -->
    <div class="tabs">
      <div class="tab-btn active" onclick="switchTab('home')">Dashboard</div>
      <div class="tab-btn" id="securityTabBtn" onclick="switchTab('security')">Security</div>
    </div>

    <!-- DASHBOARD TAB -->
    <div id="homeTab">

      <div class="kpi-grid">
        <div class="kpi primary">
          <h3>Total Units</h3>
          <h1>240</h1>
        </div>
        <div class="kpi success">
          <h3>Completed</h3>
          <h1>180</h1>
        </div>
        <div class="kpi warning">
          <h3>In Progress</h3>
          <h1>40</h1>
        </div>
        <div class="kpi danger">
          <h3>Pending</h3>
          <h1>20</h1>
        </div>
      </div>

      <div class="card">
        <h3>Activity Summary</h3>
        <table>
          <thead>
            <tr>
              <th>Activity</th>
              <th>Total</th>
              <th>Completed</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Masonry</td><td>240</td><td>200</td><td>40</td></tr>
            <tr><td>Plaster</td><td>240</td><td>180</td><td>60</td></tr>
            <tr><td>Flooring</td><td>240</td><td>150</td><td>90</td></tr>
          </tbody>
        </table>
      </div>

    </div>

    <!-- SECURITY TAB -->
    <div id="securityTab" class="hidden">

      <div class="card">
        <h3>Create Viewer Account</h3>
        <input id="newUser" placeholder="Username">
        <input id="newPass" placeholder="Password">
        <button onclick="createUser()">Create User</button>
      </div>

      <div class="card">
        <h3>Registered Users</h3>
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Created</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody id="usersTable"></tbody>
        </table>
      </div>

      <div class="card">
        <h3>Active Sessions</h3>
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Login Time</th>
              <th>Terminate</th>
            </tr>
          </thead>
          <tbody id="sessionsTable"></tbody>
        </table>
      </div>

    </div>

  </div>
</div>

<script>

// CONFIG
const ADMIN = { username:"admin", password:"Admin@123", role:"admin" };
const SESSION_TIMEOUT = 30 * 60 * 1000;

// LOGIN
function login(){
  const u = username.value;
  const p = password.value;
  loginError.innerText="";

  if(u===ADMIN.username && p===ADMIN.password){
    startSession(u,"admin");
    return;
  }

  const users = JSON.parse(localStorage.getItem("users")) || [];
  const found = users.find(x=>x.username===u && x.password===p);

  if(found) startSession(found.username,"viewer");
  else loginError.innerText="Invalid credentials";
}

function startSession(username,role){
  const session={
    id:crypto.randomUUID(),
    username,
    role,
    loginTime:Date.now()
  };

  localStorage.setItem("currentSession",JSON.stringify(session));
  let sessions=JSON.parse(localStorage.getItem("sessions"))||[];
  sessions.push(session);
  localStorage.setItem("sessions",JSON.stringify(sessions));

  loadDashboard();
}

// LOAD DASHBOARD
function loadDashboard(){
  const session=JSON.parse(localStorage.getItem("currentSession"));
  if(!session) return;

  loginScreen.classList.add("hidden");
  dashboard.classList.remove("hidden");

  loggedUser.innerText=session.username;
  userRole.innerText=session.role;

  if(session.role!=="admin"){
    securityTabBtn.classList.add("hidden");
  } else {
    renderUsers();
    renderSessions();
  }

  setInterval(checkSessionTimeout,60000);
}

// SESSION TIMEOUT
function checkSessionTimeout(){
  const session=JSON.parse(localStorage.getItem("currentSession"));
  if(!session) return logout();
  if(Date.now()-session.loginTime>SESSION_TIMEOUT){
    alert("Session expired");
    logout();
  }
}

// LOGOUT
function logout(){
  const session=JSON.parse(localStorage.getItem("currentSession"));
  if(session){
    let sessions=JSON.parse(localStorage.getItem("sessions"))||[];
    sessions=sessions.filter(s=>s.id!==session.id);
    localStorage.setItem("sessions",JSON.stringify(sessions));
  }
  localStorage.removeItem("currentSession");
  location.reload();
}

// TAB SWITCH
function switchTab(tab){
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll("#homeTab,#securityTab").forEach(t=>t.classList.add("hidden"));

  if(tab==="home"){
    document.querySelectorAll(".tab-btn")[0].classList.add("active");
    homeTab.classList.remove("hidden");
  } else {
    document.querySelectorAll(".tab-btn")[1].classList.add("active");
    securityTab.classList.remove("hidden");
  }
}

// CREATE USER
function createUser(){
  const u=newUser.value.trim();
  const p=newPass.value.trim();
  if(!u||!p) return alert("Enter username & password");

  let users=JSON.parse(localStorage.getItem("users"))||[];
  if(users.find(x=>x.username===u)) return alert("User exists");

  users.push({username:u,password:p,created:new Date().toLocaleString()});
  localStorage.setItem("users",JSON.stringify(users));

  newUser.value=""; newPass.value="";
  renderUsers();
}

// RENDER USERS
function renderUsers(){
  let users=JSON.parse(localStorage.getItem("users"))||[];
  usersTable.innerHTML="";
  users.forEach(u=>{
    usersTable.innerHTML+=`
      <tr>
        <td>${u.username}</td>
        <td>${u.created}</td>
        <td><button class="danger" onclick="deleteUser('${u.username}')">Delete</button></td>
      </tr>`;
  });
}

function deleteUser(username){
  let users=JSON.parse(localStorage.getItem("users"))||[];
  users=users.filter(u=>u.username!==username);
  localStorage.setItem("users",JSON.stringify(users));
  renderUsers();
}

// RENDER SESSIONS
function renderSessions(){
  let sessions=JSON.parse(localStorage.getItem("sessions"))||[];
  sessionsTable.innerHTML="";
  sessions.forEach(s=>{
    sessionsTable.innerHTML+=`
      <tr>
        <td>${s.username}</td>
        <td>${s.role}</td>
        <td>${new Date(s.loginTime).toLocaleString()}</td>
        <td><button class="danger" onclick="terminateSession('${s.id}')">Terminate</button></td>
      </tr>`;
  });
}

function terminateSession(id){
  let sessions=JSON.parse(localStorage.getItem("sessions"))||[];
  sessions=sessions.filter(s=>s.id!==id);
  localStorage.setItem("sessions",JSON.stringify(sessions));
  const current=JSON.parse(localStorage.getItem("currentSession"));
  if(current && current.id===id) logout();
  renderSessions();
}

// AUTO LOGIN
window.onload=()=>{
  const session=JSON.parse(localStorage.getItem("currentSession"));
  if(session) loadDashboard();
};

</script>
</body>
</html>
